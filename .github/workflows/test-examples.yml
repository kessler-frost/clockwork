name: Test Examples Suite

on:
  workflow_dispatch: # Manual trigger only

jobs:
  test-examples:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Install uv
        uses: astral-sh/setup-uv@v5
        with:
          version: "latest"

      - name: Set up Python
        run: uv python install

      - name: Install dependencies
        run: uv sync

      - name: Set up environment variables
        run: |
          echo "CW_API_KEY=${{ secrets.CW_API_KEY }}" >> $GITHUB_ENV
          echo "CW_MODEL=openai/gpt-oss-20b:free" >> $GITHUB_ENV
          echo "CW_BASE_URL=https://openrouter.ai/api/v1" >> $GITHUB_ENV
          echo "CW_LOG_LEVEL=INFO" >> $GITHUB_ENV

      - name: Test file-generation example
        working-directory: examples/file-generation
        run: |
          echo "Testing file-generation example..."
          uv run clockwork apply
          uv run clockwork assert
          uv run clockwork destroy

      - name: Test docker-service example
        working-directory: examples/docker-service
        run: |
          echo "Testing docker-service example..."
          uv run clockwork apply
          uv run clockwork assert
          uv run clockwork destroy

      - name: Test tool-integration example
        working-directory: examples/tool-integration
        run: |
          echo "Testing tool-integration example..."
          uv run clockwork apply
          # No assertions for tool-integration example
          uv run clockwork destroy

      # Note: Skipping apple-container-service as it requires macOS
      # GitHub Actions ubuntu runners don't support Apple Containers CLI
